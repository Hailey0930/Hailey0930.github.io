<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> [React]Suspense - Haileylog </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="React 18 Suspense에 대해 살펴보자! (feat. CSR, SSR)- [React]Suspense"> <meta name="keywords" content="[React]Suspense, Haileylog, React,React, suspense"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="Haileylog" property="og:site_name" /> <meta content="[React]Suspense" property="og:title" /> <meta content="article" property="og:type" /> <meta content="React 18 Suspense에 대해 살펴보자! (feat. CSR, SSR)" property="og:description" /> <meta content="http://localhost:4000/react/2023/02/08/react-suspense/" property="og:url" /> <meta content="2023-02-08T18:05:23+09:00" property="article:published_time" /> <meta content="http://localhost:4000/about/" property="article:author" /> <meta content="http://localhost:4000/assets/img/posts/230208_thumbnail.jpg" property="og:image" /> <meta content="React" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="[React]Suspense" /> <meta name="twitter:url" content="http://localhost:4000/react/2023/02/08/react-suspense/" /> <meta name="twitter:description" content="React 18 Suspense에 대해 살펴보자! (feat. CSR, SSR)" /> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css" /> <!-- <link rel="stylesheet" href="http://localhost:4000/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="http://localhost:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'http://localhost:4000' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="http://localhost:4000/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="http://localhost:4000/assets/js/mode-switcher.js"></script> <script src="http://localhost:4000/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="http://localhost:4000/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="http://localhost:4000/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="http://localhost:4000/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="http://localhost:4000/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="http://localhost:4000/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="http://localhost:4000/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="http://localhost:4000/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="http://localhost:4000/assets/js/search.js"></script> <script src="http://localhost:4000/assets/js/on-scroll-progress.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget --> <!-- <script> (function(d, h, m) { var js, fjs = d.getElementsByTagName(h)[0]; if (d.getElementById(m)) { return; } js = d.createElement(h); js.id = m; js.onload = function() { window.makerWidgetComInit({ position: "left", widget: "ofeeof264otl2l5g-zspk40eq2gaomj2n-higi2qphmveubksi" }); }; js.src = "https://makerwidget.com/js/embed.js"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "dhm"); </script> --> <!-- buy me a coffeee --> <!-- <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="sujaykundu" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10" ></script> --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body><nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">Haileylog</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/blog" >Blog</a > </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/styleguide"> Styleguide </a> </li> --> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <!-- <li class="nav-item" style="margin-top:5px; padding-right:20px;" > <a class="header__checkout snipcart-checkout"> <svg width="31" height="27" viewBox="0 0 31 27" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M1.10512 0.368718C0.560256 0.368718 0.118164 0.812066 0.118164 1.35848C0.118164 1.9049 0.560256 2.34824 1.10512 2.34824H4.90887L8.30138 18.4009C8.43503 19.0053 8.83085 19.5079 9.32946 19.5041H25.7788C26.3005 19.5118 26.7799 19.0375 26.7799 18.5143C26.7799 17.9911 26.3006 17.5168 25.7788 17.5245H10.1315L9.71003 15.545H27.095C27.5371 15.5412 27.9547 15.2048 28.0511 14.7718L30.354 4.87412C30.4825 4.29933 29.9852 3.67172 29.3979 3.66786H7.21171L6.6771 1.15221C6.58329 0.71276 6.15921 0.368652 5.7107 0.368652L1.10512 0.368718ZM7.623 5.64746H12.7634L13.2569 8.61674H8.25005L7.623 5.64746ZM14.7785 5.64746H20.9881L20.4946 8.61674H15.2719L14.7785 5.64746ZM23.0031 5.64746H28.1537L27.4649 8.61674H22.5097L23.0031 5.64746ZM8.67181 10.5963H13.5862L14.0797 13.5656H9.29919L8.67181 10.5963ZM15.6009 10.5963H20.1656L19.6721 13.5656H16.0944L15.6009 10.5963ZM22.1807 10.5963H27.0023L26.3135 13.5656H21.6872L22.1807 10.5963ZM12.6197 20.164C10.8141 20.164 9.32979 21.6525 9.32979 23.4632C9.32979 25.2739 10.8141 26.7624 12.6197 26.7624C14.4252 26.7624 15.9095 25.2739 15.9095 23.4632C15.9095 21.6525 14.4252 20.164 12.6197 20.164ZM22.4892 20.164C20.6837 20.164 19.1994 21.6525 19.1994 23.4632C19.1994 25.2739 20.6837 26.7624 22.4892 26.7624C24.2948 26.7624 25.7791 25.2739 25.7791 23.4632C25.7791 21.6525 24.2948 20.164 22.4892 20.164ZM12.6197 22.1435C13.3586 22.1435 13.9356 22.7222 13.9356 23.4632C13.9356 24.2042 13.3586 24.7829 12.6197 24.7829C11.8807 24.7829 11.3037 24.2042 11.3037 23.4632C11.3037 22.7222 11.8807 22.1435 12.6197 22.1435ZM22.4892 22.1435C23.2282 22.1435 23.8052 22.7222 23.8052 23.4632C23.8052 24.2042 23.2282 24.7829 22.4892 24.7829C21.7503 24.7829 21.1733 24.2042 21.1733 23.4632C21.1733 22.7222 21.7503 22.1435 22.4892 22.1435Z" fill="#ff7901" class="header__checkout-fill"></path> </svg> <span class="snipcart-items-count"></span> --> <!-- <span class="snipcart-total-price"></span> --> <!-- </a> </li> --> <li class="nav-item"> <input class="nav-link switch theme-toggle" type="checkbox" name="checkbox" /> </li> </ul> </nav> <div id="progress-bar"></div> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus /> <input class="search-form__submit" type="submit" value="search" /> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div> <div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">[React]Suspense</h1> <h4 class="post-meta">React 18 Suspense에 대해 살펴보자! (feat. CSR, SSR)</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">hyerin</span> </span > on <time datetime="2023-02-08 18:05:23 +0900" itemprop="datePublished" >Feb 8, 2023</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/react/2023/02/08/react-suspense/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/React" >React</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="http://localhost:4000/assets/img/posts/230208_thumbnail.jpg" alt="" /> <br /> <br /> <blockquote> <p>어쩌다 리액트 <code class="language-plaintext highlighter-rouge">Suspense</code>까지 타고 오게 됐는지 모르겠지만, <code class="language-plaintext highlighter-rouge">Suspense</code>가 대체 뭔지 몰라서 찾아보다가 쓰게 된 github.io 블로그 첫 포스트! <br /> <code class="language-plaintext highlighter-rouge">Suspense</code>에 대해 생각보다 잘 정리된 글이 없어 내가 찾아본 여러 자료를 참고하여 이해한 플로우대로 정리해보고자 한다.<br /> 또한, Suspense와 함께 유저의 웹사이트 경험 향상에 도움이 되는 <code class="language-plaintext highlighter-rouge">Error Boundary</code>도 함께 살펴보자!</p> </blockquote> <h1 id="suspense-란"><code class="language-plaintext highlighter-rouge">Suspense</code> 란?</h1> <p>React <code class="language-plaintext highlighter-rouge">Suspense</code>는 코드 스플리팅을 위해 등장한 컴포넌트이다. <br /> React 16 버전부터 React.lazy와 연계해서 사용했다. <br /> (<strong>코드 스플리팅</strong>이란, 네트워크를 통해 받아오는 Javascript를 앱 구동에 필요한 만큼만 다운로드 받아올 수 있게 잘게 나누는 것을 말한다.) <br /></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">lazy</span><span class="p">,</span> <span class="nx">Suspense</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">AvatarComponent</span> <span class="o">=</span> <span class="nx">lazy</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">"</span><span class="s2">./AvatarComponent</span><span class="dl">"</span><span class="p">));</span>

<span class="kd">const</span> <span class="nx">renderLoader</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Loading</span><span class="o">&lt;</span><span class="sr">/p&gt;</span><span class="err">;
</span>
<span class="kd">const</span> <span class="nx">DetailsComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Suspense</span> <span class="nx">fallback</span><span class="o">=</span><span class="p">{</span><span class="nx">renderLoader</span><span class="p">()}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">AvatarComponent</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="sr">/Suspense</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div></div> <h2 id="reactlazy">React.lazy</h2> <p>React는 유저가 ‘/’ 경로에서 요청할 경우 <code class="language-plaintext highlighter-rouge">App.js</code>에서 <code class="language-plaintext highlighter-rouge">Route</code>로 불러와지는 컴포넌트들을 <code class="language-plaintext highlighter-rouge">Route</code>에서 설정한 경로로 가지 않았음에도 모든 컴포넌트들을 로딩해온다.<br /> 이럴 때 <code class="language-plaintext highlighter-rouge">React.lazy</code>를 쓸 수 있다.</p> <p>[ App.js ]</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">BrowserRouter</span><span class="p">,</span> <span class="nx">Routes</span><span class="p">,</span> <span class="nx">Route</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-router-dom</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Home</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Home</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Board</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Board</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">BrowserRouter</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Routes</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span> <span class="nx">element</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Home</span> <span class="o">/&gt;</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">Routes</span> <span class="nx">path</span><span class="o">=</span><span class="dl">"</span><span class="s2">/board</span><span class="dl">"</span> <span class="nx">element</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Board</span> <span class="o">/&gt;</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/Routes</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/BrowserRouter</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>[ Board.js ]</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Huge</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">lazy</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">"</span><span class="s2">@huge-library</span><span class="dl">"</span><span class="p">));</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Board</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Huge</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>용량이 큰 라이브러리 등 많은 시간과 데이터가 소요되는 것은 <code class="language-plaintext highlighter-rouge">React.lazy</code>를 통해 비동기로 import 해옴으로써, 해당 컴포넌트에 유저가 진입했을 때만 import 되도록 설정할 수 있다.</p> <p>해당 컴포넌트에 유저가 진입할 때 import를 해오기 때문에, 유저가 순간적으로 빈 UI를 볼 수 있다. <br /> 따라서 <code class="language-plaintext highlighter-rouge">Suspense</code>와 함께 사용할 경우 큰 시너지 효과를 볼 수 있다.</p> <h1 id="16버전에서의-suspense">16버전에서의 <code class="language-plaintext highlighter-rouge">Suspense</code></h1> <p>16버전에서는 다음과 같은 한계점이 있었다.</p> <ul> <li>SSR에서는 Suspense를 지원하지 않았다.</li> <li>Suspense가 소개된 이후, Apollo, Relay 등을 이용해 data fetching 전 fallback UI를 보여주는 용도로 사용할 수 있었지만 캐싱 지원의 불안정함으로 인해 권장하지 않았다.</li> </ul> <p>React 18 버전이 나오면서, SSR에서도 Suspense를 지원하게 되었다.</p> <h1 id="csr-ssr">CSR, SSR</h1> <p>여기서 다시 살펴보는 CSR, SSR!</p> <h2 id="csr">CSR</h2> <p>CSR은 <code class="language-plaintext highlighter-rouge">Client Side Rendering</code>의 약자로, 클라이언트에서 초기 화면 로드를 위해 서버에 요청을 보내면 <code class="language-plaintext highlighter-rouge">서버</code>는 요청을 받아 클라이언트에게 HTML과 Javascript를 보내준다. <br /> <code class="language-plaintext highlighter-rouge">클라이언트</code>는 그것(HTML과 React로 짜여진 Javascript 코드)을 받아 브라우저에서 React의 Javascript 코드를 실행하여 렌더링을 시작한다.</p> <p>서버에서 HTML, Javascript를 전달해준 후 브라우저가 Javascript를 실행하기 전까지 브라우저에는 아무것도 없기 때문에, 초기 로딩 시간이 오래 걸린다. <br /> 따라서 환경이 안좋을 경우 유저는 웹사이트의 빈 화면을 볼 확률이 높다.</p> <h2 id="ssr">SSR</h2> <p>SSR은 <code class="language-plaintext highlighter-rouge">Server Side Rendering</code>의 약자로, 클라이언트에서 초기 화면 로드를 위해 서버에 요청을 보내면 <code class="language-plaintext highlighter-rouge">서버</code>는 React 코드를 실행하여 화면에 표시하는데 필요한 데이터와 CSS를 모두 삽입한 HTML을 클라이언트에게 보내준다. <br /> <code class="language-plaintext highlighter-rouge">클라이언트</code>는 흰 화면 대신 브라우저에서 꽉 채워져있는 HTML을 미리 보여주며 React의 Javascript를 로딩 및 실행시켜 인터랙션을 추가한다. <br /> ( <code class="language-plaintext highlighter-rouge">서버</code>에서 HTML에 넣어둔 React의 Javascript와 <code class="language-plaintext highlighter-rouge">클라이언트</code>에서 전달받은 React의 Javascript를 비교 및 그리는 과정을 <code class="language-plaintext highlighter-rouge">Hydration</code>이라고 한다. ) <br /></p> <p>SSR도 서버에서 먼저 전체 어플리케이션을 렌더링하기 때문에, 어떤 하나의 컴포넌트가 로딩하는데 오래 걸릴 경우 서버에서 전체 렌더링을 하는 동안에는 유저가 빈 화면을 볼 수 있다는 문제가 있다.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">App</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">Header</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nx">Posts</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="sr">/App</span><span class="err">&gt;
</span></code></pre></div></div> <p>위와 같은 코드가 있고, App 컴포넌트를 렌더링할 경우 유저는 <code class="language-plaintext highlighter-rouge">Posts</code> 컴포넌트가 렌더링이 끝나기 전까지 <code class="language-plaintext highlighter-rouge">Header</code> 컴포넌트 역시 볼 수 없다.</p> <h1 id="suspense를-활용하여-문제-해결">Suspense를 활용하여 문제 해결</h1> <p>위에서 살펴본 바와 같이, CSR SSR 모두 렌더링 과정에서 문제가 발생할 수 있다는 단점을 가지고 있다.<br /> 이는 React 18버전 <code class="language-plaintext highlighter-rouge">Suspense</code>를 통해 해결할 수 있다!</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Suspense</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="o">&lt;</span><span class="nx">App</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">Header</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nx">Suspense</span> <span class="nx">fallback</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Loader</span> <span class="o">/&gt;</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Posts</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="sr">/Suspense</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/App&gt;</span><span class="err">;
</span></code></pre></div></div> <ul> <li><code class="language-plaintext highlighter-rouge">Suspense</code>로 <code class="language-plaintext highlighter-rouge">Posts</code> 컴포넌트를 감싸줄 경우, <code class="language-plaintext highlighter-rouge">Posts</code>컴포넌트의 렌더링이 오래 걸리더라도 기존과 달리 유저는 <code class="language-plaintext highlighter-rouge">Header</code> 컴포넌트를 미리 볼 수 있다.</li> <li><code class="language-plaintext highlighter-rouge">HTTP stream</code>을 통해 <code class="language-plaintext highlighter-rouge">Posts</code> 컴포넌트가 서버에서 렌더링이 완료될 경우, 브라우저에서 React가 로딩되기도 전에 기존에 보여주던 <code class="language-plaintext highlighter-rouge">Loader</code>컴포넌트 HTML을 <code class="language-plaintext highlighter-rouge">Posts</code>컴포넌트 HTML로 대체한다.</li> <li>아직 브라우저에서 로딩되지 않은 컴포넌트를 유저가 인터랙션하길 원하는 경우 (=로딩되지 않은 컴포넌트를 클릭할 경우), 다른 컴포넌트의 hydrate를 멈추고 해당 컴포넌트의 hydrate를 먼저 실행한다.</li> </ul> <h1 id="error-boundary">Error Boundary</h1> <p><code class="language-plaintext highlighter-rouge">Error Boundary</code>는 하위 컴포넌트 트리의 어디에서는 Javascript 에러를 기록하여 깨진 컴포넌트 트리 대신 fallback UI를 보여주는 React 컴포넌트이다.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ErrorBoundary</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-error-boundary</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">UserProfileFallback</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">resetErrorBoundary</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span> <span class="na">에러</span> <span class="p">:</span> <span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span> <span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">resetErrorBoundary</span><span class="p">()}</span><span class="o">&gt;</span> <span class="nx">다시</span> <span class="nx">시도</span> <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/div&gt;</span><span class="err">;
</span><span class="p">};</span>

<span class="kd">const</span> <span class="nx">handleOnError</span> <span class="o">=</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">sendErrorToErrorTracker</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">const</span> <span class="nx">User</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="o">&lt;</span><span class="nx">ErrorBoundary</span>
    <span class="nx">FallbackComponent</span><span class="o">=</span><span class="p">{</span><span class="nx">UserProfileFallback</span><span class="p">}</span>
    <span class="nx">onError</span><span class="o">=</span><span class="p">{</span><span class="nx">handleOnError</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">UserProfile</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="sr">/ErrorBoundary</span><span class="err">&gt;
</span><span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">Error Boundary</code>를 사용할 경우 컴포넌트가 제공하는 <code class="language-plaintext highlighter-rouge">FallbackComponent</code>나 <code class="language-plaintext highlighter-rouge">onError</code>와 같은 props를 사용하여 기능을 구현할 수 있다. <br /> <code class="language-plaintext highlighter-rouge">resetErrorBoundary</code> 함수를 <code class="language-plaintext highlighter-rouge">FallbackComponent</code> 컴포넌트의 props로 제공하므로 다시 시도 등의 UI 요소도 쉽게 추가할 수 있다.</p> <h1 id="concurrent-ui-pattern-구현을-위한-suspense-error-boundary-사용">Concurrent UI Pattern 구현을 위한 Suspense, Error Boundary 사용</h1> <p>Pattern에 대해 무지한 나는, 최근 각종 Pattern에 대해 관심이 생기기 시작했고 아직까지 개념은 잡혀 있지 않은 상태다. <code class="language-plaintext highlighter-rouge">Suspense</code>에 대해 찾아보던 중, <code class="language-plaintext highlighter-rouge">Suspense</code>가 <code class="language-plaintext highlighter-rouge">Concurrent UI Pattern</code> 구현에 적합하다는 카카오페이 블로그 글을 보고 <code class="language-plaintext highlighter-rouge">Concurrent UI Pattern</code>에 대해 공부를 해봤다.</p> <h2 id="concurrent-ui-pattern-이란">Concurrent UI Pattern 이란?</h2> <p><code class="language-plaintext highlighter-rouge">Concurrent</code>는 ‘동시의’라는 뜻을 갖고 있다. <br /> Javascript나 Javascript를 기반으로 만들어진 React는 다중 코어를 이용하여 병렬적으로 실생시키는 언어 또는 라이브러리가 아니기 때문에, <strong>Concurrent 모드</strong>는 최대한 동시성을 추구할 수 있는 방법을 도입하겠다는 의미를 담고 있다.</p> <p>DOM 트리가 복잡해질수록 반응성 저하 등의 문제가 발생할 수 있는데, Concurrent 모드를 사용하면 앱이 빠른 반응 속도를 유지하도록 해주고 사용자 기기의 성능과 네트워크 속도에 맞춰 동작할 수 있게끔 만들 수 있다.<br /> 이를 위해, <code class="language-plaintext highlighter-rouge">우선 순위에 따른 화면 렌더</code>, <code class="language-plaintext highlighter-rouge">컴포넌트의 지연 렌더</code>, <code class="language-plaintext highlighter-rouge">로딩 화면의 유연한 구성</code> 등을 쉽게 구성할 수 있도록 특성화된 기능들을 제공하고 있는데 이러한 기능들을 사용한 UI 개발 패턴을 React 팀에서 <code class="language-plaintext highlighter-rouge">Concurrent UI Pattern</code>이라고 부른다.</p> <p><code class="language-plaintext highlighter-rouge">Concurrent UI Pattern</code> 작성 방식은 개발론에서의 <code class="language-plaintext highlighter-rouge">선언적 프로그래밍</code>을 설명하는 방식과 비슷하다.<br /> 일반적으로 개발할 때 컴포넌트를 <code class="language-plaintext highlighter-rouge">어떻게</code> 애플리케이션 상태에 따라 화면을 보여줄지에 집중하지만, <code class="language-plaintext highlighter-rouge">Concurrent UI Pattern</code>을 사용할 경우 사용자 경험 향상을 위해 컴포넌트가 <code class="language-plaintext highlighter-rouge">무엇을</code> 애플리케이션에서 보여줄지에 집중한다.</p> <h2 id="suspense-error-boundary-with-react-query">Suspense, Error Boundary with React Query</h2> <p>React에서 비동기 데이터 관리를 위해 사용되는 라이브러리 <code class="language-plaintext highlighter-rouge">React Query</code>에서는 비동기 데이터 요청 시 <code class="language-plaintext highlighter-rouge">Suspense</code>와 <code class="language-plaintext highlighter-rouge">Error Boundary</code>를 활용할 수 있는 옵션을 제공한다.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useQuery</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-query</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ErrorBoundary</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-error-boundary</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Suspense</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">queryKey</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">user</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">queryFn</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">axios</span><span class="p">(</span><span class="dl">'</span><span class="s1">/user</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">UserProfile</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useQuery</span><span class="p">(</span><span class="nx">queryKey</span><span class="p">,</span> <span class="nx">queryFn</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// 데이터 불러오기를 위한 Suspense를 활성화하는 옵션</span>
    <span class="na">suspense</span><span class="p">:</span> <span class="kc">true</span>
    <span class="c1">// Error Boundary 사용을 위한 옵션으로, suspense 옵션이 true인 경우 기본값이 true로 설정된다.</span>
    <span class="na">useErrorBoundary</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">})</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span> <span class="sr">/ {data.birthDay</span><span class="err">}
</span>    <span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">UserProfileFallback</span> <span class="o">=</span> <span class="p">({</span><span class="nx">error</span><span class="p">,</span> <span class="nx">resetErrorBoundary</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span> <span class="na">에러</span><span class="p">:</span> <span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span> <span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">resetErrorBoundary</span><span class="p">()}</span><span class="o">&gt;</span> <span class="nx">다시</span> <span class="nx">시도</span> <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="p">};</span>

<span class="kd">const</span> <span class="nx">UserProfileLoading</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">사용자</span> <span class="nx">정보를</span> <span class="nx">불러오는</span> <span class="nx">중입니다</span><span class="p">.</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">const</span> <span class="nx">User</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="o">&lt;</span><span class="nx">ErrorBoundary</span> <span class="nx">FallbackComponent</span><span class="o">=</span><span class="p">{</span><span class="nx">UserProfileFallback</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Suspense</span> <span class="nx">fallback</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">UserProfileLoading</span> <span class="o">/&gt;</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">UserProfile</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/Suspense</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/ErrorBoundary</span><span class="err">&gt;
</span><span class="p">};</span>
</code></pre></div></div> <p>&lt; 참고 : <br /> https://www.youtube.com/watch?v=7mkQi0TlJQo <br /> https://tech.kakaopay.com/post/react-query-2/#%EC%84%A0%EC%96%B8%ED%98%95-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-react-component &gt;</p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="http://localhost:4000/react/2023/02/08/react-suspense/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> </div><div class="comments"><!-- Hyvor Comments. For more info visit https://talk.hyvor.com --> <div id="hyvor-talk-view"></div> <script type="text/javascript"> var HYVOR_TALK_WEBSITE = '476'; var HYVOR_TALK_CONFIG = { url: 'http://localhost:4000/react/2023/02/08/react-suspense/', id: '/react/2023/02/08/react-suspense', palette: { accent: "#EB8E3F", accentText: "#080808", footerHeader: "#171616", footerHeaderText: "#656363", box: "#3A3A38", boxText: "#E0E0E0", boxLightText: "#AAAAAA", backgroundText: "#E0E0E0" } }; </script> <script async type="text/javascript" src="//talk.hyvor.com/web-api/embed"></script> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "http://localhost:4000/react/2023/02/08/react-suspense/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/react/2023/02/08/react-suspense"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Hyerin Jeon</div> <div class="card-body"> <p class="author_bio">안녕하세요, 전혜린 (Hailey) 입니다! 주니어 프론트엔드 개발자이며, 리액트를 사용하고 있습니다 :D</p> <!--<!-- Place this tag where you want the github button to render. --> <!-- <a class="github-button" href="https://github.com/sujaykundu777/devlopr-jekyll" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a> --> --> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#React"></div> <li class="tag-head"> <a href="/blog/categories/React">React</a> </li> <a name="React"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://localhost:4000/">Home</a> </li> <li> <a href="http://localhost:4000/about">About</a> </li> <li> <a href="http://localhost:4000/blog">Blog</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters --> <!-- <form action="https://sujaykundu.us10.list-manage.com/subscribe/post?u=50bab1c85eae24ecfb0f68361&amp;id=3a2dd721d0"method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> <div id="mc_embed_signup_scroll_footer"> <label for="mce-EMAIL_footer"> Signup for Weekly Email Newsletters :D</label> <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL_footer" placeholder="email address" required> --> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <!-- <div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_50bab1c85eae24ecfb0f68361_3a2dd721d0" tabindex="-1" value=""> </div><br /> <div class="clear"> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe_footer" class="btn btn-lg btn-success"> </div> --> </div> </div><footer> <p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a>. Hosted with <a href="https://pages.github.com">Github Pages</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
